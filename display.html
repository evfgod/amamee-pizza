<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คิวรอรับสินค้า - AMAMEE PIZZA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; overflow: hidden; }
        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body class="flex bg-slate-900 h-screen">

    <div class="w-[40%] bg-black">
        <iframe class="w-full h-full" 
    src="https://www.youtube.com/embed/jU1R4GXhNGU?autoplay=1&mute=1&loop=1&playlist=jU1R4GXhNGU" 
    title="Amamee Pizza Video" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
    referrerpolicy="strict-origin-when-cross-origin" 
    allowfullscreen>
</iframe>
    </div>

    <div class="w-[60%] bg-white flex flex-col">
        <div class="bg-red-600 text-white p-6 text-center shadow-lg">
            <h1 class="text-5xl font-black italic">AMAMEE PIZZA</h1>
            <p class="text-xl font-bold mt-2">กรุณารอเรียกหมายเลขคิว</p>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 space-y-6" id="queue-display">
            <div class="text-center py-20">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"></div>
                <p class="text-slate-400 text-xl font-bold">กำลังโหลดข้อมูลคิว...</p>
            </div>
        </div>
    </div>

    <script>
        // *** ใช้ URL เดียวกับหน้า POS ***
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyboW78oQNCDj80VQxMYVzPwO5X-X5rqLGxnakcXOOKpVP3usAxNSyigIV8_T1NBgy_VQ/exec'; 

        function fetchQueue() {
            // สร้าง Callback รับข้อมูล (JSONP) เพื่อเลี่ยง CORS
            window.callback = function(data) {
                renderDisplay(data);
                const oldScript = document.getElementById('jsonp-script');
                if (oldScript) oldScript.remove();
            };

            const script = document.createElement('script');
            script.id = 'jsonp-script';
            script.src = `${WEB_APP_URL}?action=getHistory&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        function renderDisplay(data) {
            const container = document.getElementById('queue-display');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="text-center py-20 text-slate-300 text-2xl font-bold">ไม่มีคิวในขณะนี้</div>';
                return;
            }

            // กรองเอาเฉพาะคิวที่สถานะเป็น 'รอดำเนินการ' หรือ 'กำลังดำเนินการ'
            const activeQueues = data.filter(item => 
                item.status === 'รอดำเนินการ' || item.status === 'กำลังดำเนินการ'
            );

            if (activeQueues.length === 0) {
                container.innerHTML = '<div class="text-center py-20 text-slate-300 text-2xl font-bold">ไม่มีคิวในขณะนี้</div>';
                return;
            }

            container.innerHTML = activeQueues.map(q => {
                const isWorking = q.status === 'กำลังดำเนินการ';
                return `
                <div class="border-[6px] ${isWorking ? 'border-orange-500 shadow-orange-200 blink' : 'border-slate-100'} rounded-[3rem] p-10 text-center shadow-2xl transition-all">
                    <p class="${isWorking ? 'text-orange-500' : 'text-slate-400'} font-black text-xl uppercase mb-2">
                        ${isWorking ? '● กำลังปรุงอาหาร' : 'รอคิว'}
                    </p>
                    <h2 class="text-8xl font-black text-slate-800">${extractQ(q.items)}</h2>
                </div>
                `;
            }).join('');
        }

        function extractQ(text) {
            // ดึงเลขคิวจากข้อความ "(คิว 1) ฮาวายเอี้ยน..."
            const match = text.match(/คิว (\d+)/);
            return match ? `คิวที่ ${match[1]}` : 'คิวใหม่';
        }

        // อัปเดตข้อมูลอัตโนมัติทุก 10 วินาที
        setInterval(fetchQueue, 10000);
        window.onload = fetchQueue;
    </script>
</body>
</html>
